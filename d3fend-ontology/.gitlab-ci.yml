# This file is a template, and might need editing before it works on your project.
# To contribute improvements to CI/CD templates, please follow the Development guide at:
# https://docs.gitlab.com/ee/development/cicd/templates.html
# This specific template is located at:
# https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Getting-Started.gitlab-ci.yml

# This is a sample GitLab CI/CD configuration file that should run without any modifications.
# It demonstrates a basic 3 stage CI/CD pipeline. Instead of real tests or scripts,
# it uses echo commands to simulate the pipeline execution.
#
# A pipeline is composed of independent jobs that run scripts, grouped into stages.
# Stages run in sequential order, but jobs within stages run in parallel.
#
# For more information, see: https://docs.gitlab.com/ee/ci/yaml/index.html#stages

stages:          # List of stages for jobs, and their order of execution
  - build
  - test
  - deploy

build:       # This job runs in the build stage, which runs first.
  stage: build
  script:
    #- yum install make -y
    #- docker compose build d3fend-ontology
    - echo passthrough

test:       # This job runs in the test stage
  stage: test
  script:
    #- docker compose run --rm d3fend-ontology make test-load-ttl
    - echo passthrough


# ------------------------------------------------------------------------------
# Ontology â†’ Builder pipeline: overwrite SPARQL query cache in builder
#
# This job triggers a pipeline in D3FEND/d3fend-builder that rebuilds the site
# using this ontology ref and forces SPARQL queries to overwrite the shared
# Redis-backed query cache:
#
#   - QUERY_CACHE_MODE=OVERWRITE
#       * Frontend SPARQL calls execute against Blazegraph and overwrite the
#         corresponding Redis query cache entries (per query+format+target+
#         ontology hash).
#
#   - ROUTE_CACHE_MODE=DISABLED
#       * Disables route-level caching in src/hooks.server.js for this run so
#         only the query cache is affected.
#
#   - CACHE=redis
#       * Redis is the backend used by the query cache (and would be used by
#         the route cache if ROUTE_CACHE_MODE were enabled).
# ------------------------------------------------------------------------------
deploy:
  stage: deploy
  trigger:
    project: D3FEND/d3fend-builder
  variables:
    ONTOLOGY_REF: $CI_COMMIT_REF_NAME
    QUERY_CACHE_MODE: "OVERWRITE"
    ROUTE_CACHE_MODE: "DISABLED"
